<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Edit Product</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.0.0/mdb.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div class="h-100 p-5" style="background-color: #eee;">
    <div class="container h-100">
      <div class="row d-flex justify-content-center align-items-center h-100">
        <div class="col-lg-12 col-xl-11">
          <div class="card text-black" style="border-radius: 25px;">
            <div class="card-body p-md-5">
              <div class="row justify-content-center">
                <div class="col-md-10 col-lg-6 col-xl-7 d-flex justify-content-center align-items-center order-1 order-lg-1">
                  <img id="productImage" src="<%= product.imageUrl %>" class="img-fluid" height="400px" alt="Product Image">
                </div>
                <div class="col-md-10 col-lg-6 col-xl-5 order-2 order-lg-2">
                  <p class="text-center h1 fw-bold mb-5 mx-1 mx-md-4 mt-4">Edit Product</p>

                  <form id="editProductForm" class="mx-1 mx-md-4">
                    <div class="d-flex flex-row align-items-center mb-4">
                      <i class="fas fa-box fa-lg me-3 fa-fw"></i>
                      <div data-mdb-input-init class="form-outline flex-fill mb-0">
                        <input type="text" class="form-control" id="productName" name="name" value="<%= product.name %>" required />
                        <label class="form-label" for="productName">Product Name</label>
                      </div>
                    </div>

                    <div class="d-flex flex-row align-items-center mb-4">
                      <i class="fas fa-align-left fa-lg me-3 fa-fw"></i>
                      <div data-mdb-input-init class="form-outline flex-fill mb-0">
                        <textarea class="form-control" id="productDescription" name="description" required><%= product.description %></textarea>
                        <label class="form-label" for="productDescription">Description</label>
                      </div>
                    </div>

                    <div class="mb-4">
                      <label class="form-label">
                        <i class="fa-solid fa-list me-2"></i>
                        Category
                      </label>
                      <div class="ms-5">
                        <div class="form-check">
                          <input class="form-check-input" type="radio" name="category" id="categoryClothes" value="clothes" <%= product.category === 'clothes' ? 'checked' : '' %> required />
                          <label class="form-check-label" for="categoryClothes">Clothes</label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input" type="radio" name="category" id="categoryShoes" value="shoes" <%= product.category === 'shoes' ? 'checked' : '' %> />
                          <label class="form-check-label" for="categoryShoes">Shoes</label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input" type="radio" name="category" id="categoryAccessories" value="accessories" <%= product.category === 'accessories' ? 'checked' : '' %> />
                          <label class="form-check-label" for="categoryAccessories">Accessories</label>
                        </div>
                        <div class="form-check">
                          <input class="form-check-input" type="radio" name="category" id="categoryOther" value="other" <%= product.category === 'other' ? 'checked' : '' %> />
                          <label class="form-check-label" for="categoryOther">Other</label>
                        </div>
                      </div>
                    </div>

                    <div class="d-flex flex-row align-items-center mb-4">
                      <i class="fas fa-tag fa-lg me-3 fa-fw"></i>
                      <div data-mdb-input-init class="form-outline flex-fill mb-0">
                        <input type="number" class="form-control" id="productPrice" name="price" value="<%= product.price %>" required min="0" step="0.01" />
                        <label class="form-label" for="productPrice">Price</label>
                      </div>
                    </div>

                    <div class="d-flex flex-row align-items-center mb-4">
                      <i class="fas fa-warehouse fa-lg me-3 fa-fw"></i>
                      <div data-mdb-input-init class="form-outline flex-fill mb-0">
                        <input type="number" class="form-control" id="productStock" name="stock" value="<%= product.stock %>" required min="0" />
                        <label class="form-label" for="productStock">Stock</label>
                      </div>
                    </div>

                    <div class="d-flex flex-row align-items-center mb-4">
                      <i class="fas fa-image fa-lg me-3 fa-fw"></i>
                      <div data-mdb-input-init class="form-outline flex-fill mb-0">
                        <input type="url" class="form-control" id="productImageUrl" name="imageUrl" value="<%= product.imageUrl %>" onchange="updateImg(event)" required />
                        <label class="form-label" for="productImageUrl">Image URL</label>
                      </div>
                    </div>

                    <div class="d-flex justify-content-center mx-4 mb-3 mb-lg-4">
                      <button type="submit" class="btn btn-primary btn-lg">Update Product</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.0.0/mdb.umd.min.js"></script>

  <script>
    function updateImg(event) {
      const imageUrl = event.target.value;
      const productImage = document.getElementById('productImage');
      productImage.src = imageUrl;
    }

    document.getElementById('editProductForm').addEventListener('submit', function(e) {
      e.preventDefault(); // Prevent default form submission

      const productId = '<%= product.id %>';

      const formData = {
        name: document.getElementById('productName').value,
        description: document.getElementById('productDescription').value,
        category: document.querySelector('input[name="category"]:checked').value,
        price: document.getElementById('productPrice').value,
        stock: document.getElementById('productStock').value,
        imageUrl: document.getElementById('productImageUrl').value,
      };

      // Check for empty fields
      if (!formData.name || !formData.description || !formData.category || !formData.price || !formData.stock || !formData.imageUrl) {
        return alert('All fields should be filled');
      }

      console.log(formData);
      console.log(JSON.stringify(formData));

      fetch(`/admin/editProduct/${productId}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData),
        })
        .then(response => response.json())
        .then(data => {
          alert(data.message);
          window.location.href = '/admin';
        })
        .catch((error) => {
          alert('Some Error Occurred in Adding the Product')
          // console.error('Error:', error);
        });
    })
  </script>
</body>

</html>